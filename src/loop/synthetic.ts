import { getFlag, getSetting } from '../store/settings'; import { saveReceipt } from '../store/receipts'; import { log } from '../store/logs'; let timer:NodeJS.Timeout|null=null; function makeTx(){ const rails=['X402','CARD']; const status=['SIMULATED','PENDING','CONFIRMED','ENVELOPED']; const rail=rails[Math.floor(Math.random()*rails.length)]; const st=status[Math.floor(Math.random()*status.length)]; const amt=Math.floor(Math.random()*900)+100; const payload={ demo:true, amountMinor:amt, counterparty: rail==='X402'?'cb:demo':'card:token_demo', memo:'synthetic '+Date.now() }; saveReceipt(rail,st,payload); log('info',`synthetic: ${rail} ${st} ${amt}`) } export function startSynthetic(){ if(timer) return; const rate=Math.max(1, parseInt(getSetting('SYNTHETIC_RATE')||'10',10)); const interval=Math.floor(60000/rate); timer=setInterval(()=>{ if(getFlag('SANDBOX_MODE')&&getFlag('SYNTHETIC_AGENTS')) makeTx() }, interval); log('info',`synthetic: started @ ${rate}/min`) } export function stopSynthetic(){ if(timer){ clearInterval(timer); timer=null; log('warn','synthetic: stopped') } }